#+TITLE: My Listing Style
#+AUTHOR: Noboru Murata
#+EMAIL: noboru.murata@gmail.com
#+DATE: 2020.05.05 16:24:52
#+STARTUP: hidestars content
#+OPTIONS: date:t H:4 num:nil toc:nil \n:nil
#+OPTIONS: @:t ::t |:t ^:t -:t f:t *:t TeX:t LaTeX:t 
#+OPTIONS: skip:nil d:nil todo:t pri:nil tags:not-in-toc
#+PROPERTY: header-args+ :tangle mylist.sty
# C-c C-v t tangle

* Main
#+begin_src latex
\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{mylist}[2020/03/20, mura's list style version 1.0]

%% including R scripts and graphics
\RequirePackage{xparse}
\RequirePackage{subcaption}
\RequirePackage{tcolorbox}
\tcbuselibrary{breakable,skins}

\newcommand{\codename}{Rscript}
\providecommand{\baseurl}{}
\providecommand{\codedir}{}

\NewDocumentEnvironment{myCode}{s o} % no fig version
{% begin
  \small\renewcommand{\baselinestretch}{.92}%
  \begin{tcolorbox}[
    enhanced jigsaw,
    breakable,
    size=small,
    colback=[named]myLightOrange,
    colframe=[named]myDarkOrange,
    % colback=red!5!white,
    % colframe=red!75!black,
    fonttitle=\ttfamily,
    % fonttitle=\bfseries,
    % title=My breakable box,
    pad at break=2mm,
    drop fuzzy shadow,
    % height fixed for=all,
    % break at=11.4cm
    ]
    \IfValueT{#2}{\marginnote{%
        \codename:\space\href{\baseurl\codedir/#2.r}{\texttt{#2.r}}%
      }}\nobreak%
    \vspace*{6pt}
    \IfBooleanF{#1}{%
      \underline{\bfseries\figurename\space\ref{fig:#2}\space 参照}}
  }{ % end
    \vspace*{6pt}
  \end{tcolorbox}
} 
\ExplSyntaxOn
\cs_new:cpn {myCode*} {\myCode*}
\cs_new_eq:cN {endmyCode*} \endmyCode
\ExplSyntaxOff

%% PDF file handling
\newcounter{GraphPage}
\NewDocumentCommand\GraphFile{m}{
  \gdef\myFile{#1}
  \setcounter{GraphPage}{1}
}
\newlength{\GraphWidth}
\NewDocumentCommand\myGraph{s O{.45} m}{%
  \IfBooleanTF{#1}
  {% if starred, set GraphWidth with extra margin
    \setlength{\GraphWidth}{\linewidth}
    \addtolength{\GraphWidth}{\marginparwidth}
    \addtolength{\GraphWidth}{\marginparsep}
  }
  {\setlength{\GraphWidth}{\linewidth}}
  \IfNoValueOrEmptyTF{#3}
  {% no caption
    \includegraphics[page=\value{GraphPage},
    width=#2\GraphWidth]{\myFile}
  }{ 
    \begin{subfigure}[b]{#2\GraphWidth}
      \centering
      \includegraphics[page=\value{GraphPage},
      width=\linewidth]{\myFile}
      \caption{#3}
    \end{subfigure}
  }
  \stepcounter{GraphPage}
}
\NewDocumentCommand\emptyGraph{O{.45}}{%
  \parbox{#1\linewidth}{\strut} % 空の箱
}

\endinput
#+end_src

* References
  - tufte package
  - https://github.com/fmarotta/kaobook
  - https://bedienhaptik.de
* COMMENT Local file settings for Emacs

# Local Variables:
# time-stamp-line-limit: 1000
# time-stamp-format: "%04y.%02m.%02d %02H:%02M:%02S"
# time-stamp-active: t
# time-stamp-start: "#\\+DATE:[ \t]*"
# time-stamp-end: "$"
# org-src-preserve-indentation: t
# org-edit-src-content-indentation: 0
# End:

