#+TITLE: My Listing Style
#+AUTHOR: Noboru Murata
#+EMAIL: noboru.murata@gmail.com
#+DATE: 2020.08.18 14:49:23
#+STARTUP: hidestars content
#+OPTIONS: date:t H:4 num:nil toc:nil \n:nil
#+OPTIONS: @:t ::t |:t ^:t -:t f:t *:t TeX:t LaTeX:t 
#+OPTIONS: skip:nil d:nil todo:t pri:nil tags:not-in-toc
#+PROPERTY: header-args+ :tangle mylist.sty
# C-c C-v t tangle

* Main
#+begin_src latex
\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{mylist}[2020/03/20, mura's list style version 1.0]

%% simple listings for R
\RequirePackage{listings} 
\lstset{ %
  language=R,                     % the language of the code
  basicstyle=\footnotesize,       % the size of the fonts that are used for the code
  % basicstyle=\small,            % print whole listing small
  numbers=left,                   % where to put the line-numbers
  numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
  stepnumber=1,                   % the step between two line-numbers. If it's 1, each line
                                  % will be numbered
  numbersep=5pt,                  % how far the line-numbers are from the code
  % backgroundcolor=\color{pink}, % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  frame=none,                     % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
  % title=\lstname,               % show the filename of files included with \lstinputlisting;
  %                               % also try caption instead of title
  keywordstyle=\color{black}\ttfamily, % keyword style
  % keywordstyle=\color{black}\bfseries\underbar,
  commentstyle=\color{blue},      % comment style
  % commentstyle=\color{white},
  stringstyle=\color{orange}\ttfamily, % string literal style
  % stringstyle=\ttfamily,
  identifierstyle=\ttfamily,
  escapeinside={\%*}{*)},  % if you want to add a comment within your code
  morekeywords={*,...},    % if you want to add more keywords to the set
  alsoletter={.},
} 

%% including R scripts and graphics
\RequirePackage{xparse}
\RequirePackage{subcaption}
\RequirePackage{tcolorbox}
\tcbuselibrary{breakable,skins}

\newcommand{\codename}{Rscript}
\providecommand{\baseurl}{}
\providecommand{\codedir}{}

\NewDocumentEnvironment{myCode}{s o} % no fig version
{% begin
  \small\renewcommand{\baselinestretch}{.92}%
  \begin{tcolorbox}[
    enhanced jigsaw,
    breakable,
    size=small,
    colback=[named]myLightOrange,
    colframe=[named]myDarkOrange,
    % colback=red!5!white,
    % colframe=red!75!black,
    fonttitle=\ttfamily,
    % fonttitle=\bfseries,
    % title=My breakable box,
    pad at break=2mm,
    drop fuzzy shadow,
    % height fixed for=all,
    % break at=11.4cm
    ]
    \IfValueT{#2}{\marginnote{%
        \codename:\space\href{\baseurl\codedir/#2.r}{\texttt{#2.r}}%
      }}\nobreak%
    \vspace*{6pt}
    \IfBooleanF{#1}{%
      \underline{\bfseries\figurename\space\ref{fig:#2}\space 参照}}
  }{ % end
    \vspace*{6pt}
  \end{tcolorbox}
} 
\ExplSyntaxOn
\cs_new:cpn {myCode*} {\myCode*}
\cs_new_eq:cN {endmyCode*} \endmyCode
\ExplSyntaxOff

%% PDF file handling
\newcounter{GraphPage}
\NewDocumentCommand\GraphFile{m}{
  \gdef\myFile{#1}
  \setcounter{GraphPage}{1}
}
\newlength{\GraphWidth}
\NewDocumentCommand\myGraph{s O{.45} m}{%
  \IfBooleanTF{#1}
  {% if starred, set GraphWidth with extra margin
    \setlength{\GraphWidth}{\linewidth}
    \addtolength{\GraphWidth}{\marginparwidth}
    \addtolength{\GraphWidth}{\marginparsep}
  }
  {\setlength{\GraphWidth}{\linewidth}}
  \IfNoValueOrEmptyTF{#3}
  {% no caption
    \includegraphics[page=\value{GraphPage},
    width=#2\GraphWidth]{\myFile}
  }{ 
    \begin{subfigure}[b]{#2\GraphWidth}
      \centering
      \includegraphics[page=\value{GraphPage},
      width=\linewidth]{\myFile}
      \caption{#3}
    \end{subfigure}
  }
  \stepcounter{GraphPage}
}
\NewDocumentCommand\emptyGraph{O{.45}}{%
  \parbox{#1\linewidth}{\strut} % 空の箱
}

\endinput
#+end_src

* References
  - tufte package
  - https://github.com/fmarotta/kaobook
  - https://bedienhaptik.de
* COMMENT Local file settings for Emacs

# Local Variables:
# time-stamp-line-limit: 1000
# time-stamp-format: "%Y.%02m.%02d %02H:%02M:%02S"
# time-stamp-active: t
# time-stamp-start: "#\\+DATE:[ \t]*"
# time-stamp-end: "$"
# org-src-preserve-indentation: t
# org-edit-src-content-indentation: 0
# End:

